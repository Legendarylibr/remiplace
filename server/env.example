# =====================================================
# (r) EMI / Place Server Configuration
# Copy this file to .env and customize
# =====================================================

# Server
PORT=3001
NODE_ENV=development

# Database
DATABASE_PATH=./data/canvas.db

# JWT Authentication
# IMPORTANT: Change this in production! Must be at least 32 characters.
JWT_SECRET=change-this-to-a-secure-random-string-in-production
JWT_EXPIRES_IN=24h

# CORS
# Set to specific origin in production (e.g., https://yourdomain.com)
# MUST be set to a specific domain in production - wildcard (*) is rejected
CORS_ORIGIN=*

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
PIXEL_RATE_LIMIT=30

# Canvas Configuration
CANVAS_WIDTH=220
CANVAS_HEIGHT=150

# NFT Gating
# Set to 'true' to enable NFT verification
NFT_GATING_ENABLED=false

# RPC URLs for NFT verification (use Alchemy URLs for best results)
ETH_RPC_URL=https://eth.llamarpc.com
BASE_RPC_URL=https://mainnet.base.org

# NFT Contracts (JSON arrays)
# ERC-721: [{"address": "0x...", "name": "My NFT", "chainId": 1}]
# ERC-1155: [{"address": "0x...", "name": "My NFT", "tokenIds": [1, 2, 3]}]
ERC721_CONTRACTS=[]
ERC1155_CONTRACTS=[]

# WebSocket
WS_HEARTBEAT_INTERVAL=30000
# Debounce pixel broadcasts to batch high-frequency updates (ms)
WS_BROADCAST_DEBOUNCE_MS=50
# Max pixels to buffer before forcing a broadcast
WS_MAX_BROADCAST_BUFFER=100
# Max WebSocket connections per IP address
WS_MAX_CONNECTIONS_PER_IP=10
# Max total WebSocket connections across all IPs
WS_MAX_TOTAL_CONNECTIONS=10000

# Performance Optimizations
# Stats cache TTL (ms) - reduces expensive COUNT queries
STATS_CACHE_TTL_MS=5000
# Maximum history entries before pruning old ones
HISTORY_MAX_ENTRIES=100000
# Number of history entries to prune at once
HISTORY_PRUNE_BATCH=10000

# =====================================================
# BACKUP CONFIGURATION
# =====================================================

# Directory to store database backups
BACKUP_DIR=./data/backups
# Maximum number of backups to keep (older ones are deleted)
MAX_BACKUPS=10
# Backup interval in milliseconds (default: 6 hours)
BACKUP_INTERVAL_MS=21600000

# =====================================================
# AUTOSCALING / HORIZONTAL SCALING
# =====================================================

# Redis Configuration (required for multiple instances)
# Enable Redis for cross-instance WebSocket broadcasting and nonce tracking
REDIS_ENABLED=false
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Instance ID (auto-generated if not set)
# Useful for debugging in multi-instance deployments
INSTANCE_ID=

# Cluster Mode (for multi-core scaling on single machine)
# Set number of worker processes (defaults to CPU cores)
WORKERS=

# Admin Wallets (comma-separated Ethereum addresses)
# These wallets can use admin features like erasing pixels, clearing canvas, etc.
ADMIN_WALLETS=

# =====================================================
# LOGGING
# =====================================================

# Log level (trace, debug, info, warn, error, fatal)
LOG_LEVEL=info
